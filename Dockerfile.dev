# Development image with all tools and hot-reload

FROM rust:1.92

# Install development tools
RUN apt-get update && apt-get install -y \
    pkg-config \
    libssl-dev \
    git \
    vim \
    curl \
    build-essential \
    gdb \
    lldb \
    valgrind \
    && rm -rf /var/lib/apt/lists/*

# Install Rust tools
RUN rustup component add rustfmt clippy rust-analyzer && \
    cargo install --locked cargo-watch cargo-edit cargo-audit cargo-tarpaulin cargo-outdated

# Create workspace
RUN mkdir -p /workspace
WORKDIR /workspace

# Set up user (optional, for permissions)
ARG USER_ID=1000
ARG GROUP_ID=1000
RUN groupadd -g ${GROUP_ID} developer && \
    useradd -m -u ${USER_ID} -g developer developer && \
    chown -R developer:developer /workspace

USER developer

# Expose ports for development
EXPOSE 7878 9090 5678

# Keep container running
CMD ["bash"]